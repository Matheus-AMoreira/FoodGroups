@page "/grupos/criar"
@using FoodGroups.DTOs
@using FoodGroups.Models
@inject IGrupoService GrupoService
@inject NavigationManager Navigation

<h1>Novo Grupo</h1>

<div class="form-container">
    <EditForm Model="@novoGrupo" OnValidSubmit="HandleValidSubmit">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="form-group">
            <label>Nome do Grupo:</label>
            <InputText class="form-control" @bind-Value="novoGrupo.Nome" />
        </div>

        <div class="form-group">
            <label>Capacidade Máxima:</label>
            <InputNumber class="form-control" @bind-Value="novoGrupo.CapacidadeMaxima" />
        </div>

        <div class="form-group">
            <label>ID do Criador (Temp):</label>
            <InputNumber class="form-control" @bind-Value="novoGrupo.CriadorId" />
            <small style="color: #666;">Em produção, pegar do usuário logado.</small>
        </div>

        <button type="submit" class="btn btn-primary">Criar Grupo</button>
        <a href="/" class="btn btn-secondary">Cancelar</a>
    </EditForm>
</div>

@code {
    // Usando o DTO, mas o service espera um Modelo 'Grupo'. Faremos a conversão.
    private CriarGrupoDTO novoGrupo = new CriarGrupoDTO 
    { 
        Nome = "", 
        CapacidadeMaxima = 10,
        CriadorId = 1
    };

    private async Task HandleValidSubmit()
    {
        var grupoModel = new Grupo
        {
            Nome = novoGrupo.Nome,
            CapacidadeMaxima = novoGrupo.CapacidadeMaxima,
            CriadorId = novoGrupo.CriadorId
        };

        await GrupoService.CriarGrupo(grupoModel);
        Navigation.NavigateTo("/"); // Redireciona para Home pois não temos tela de lista de grupos
    }
}